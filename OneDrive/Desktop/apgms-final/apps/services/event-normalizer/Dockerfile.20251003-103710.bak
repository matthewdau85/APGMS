FROM python:3.11-slim

WORKDIR /app

# Copy only pyproject first for layer caching
COPY apps/services/event-normalizer/pyproject.toml ./pyproject.toml

# Install deps via poetry (no venv inside the container)
RUN pip install --no-cache-dir poetry \
 && poetry config virtualenvs.create false \
 && poetry install --no-interaction --no-ansi

# Now add the source
COPY apps/services/event-normalizer/app ./app
COPY libs/json /libs/schemas/json

EXPOSE 8001
CMD ["uvicorn","app.main:app","--host","0.0.0.0","--port","8001"]
