# File: chunk_000563.txt (part 1 of 1)
```
were loaded. Master key load will be unsuccessful. 63 Host’s public key loaded on ATM but ATM’s public key not loaded on host. Master key load will be unsuccessful. IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 34 F.5.4 Generation of double-length ATM Master Key Host eKMVA0(SK-HSM) APCA2000 NODEKEKSEND- NDC+ C720 42 21 eKMVAA(A) KVC(A) [A-key] PK-EPP Extended Encryption Key Load ‘C’ message NCR NDC+ ATM COMPARE Verify signature and decrypt KVC(A-key) Encryptor Initialisation Data ‘3’ message ([A-key] PK-EPP) * SK-HSM eKMVAC(PK-EPP) 42 A-Key PK-HSM SK-EPP Figure 4 Generation of double-length ATM Master Key F.5.5 Remote Initialisation 1. The host uses SCM function C720 to generate a random double-length master key. The SCM function pads the master key to 256 bytes and encrypts it with the EPP’s public key received earlier (see F.5.3) and signs it with the HSM’s secret key generated earlier (see F.5.1). 2. The hosts sends the encrypted master key and signature to the ATM in an Extended Encryption Key Load message (Message Class 3, Message Sub- class 4) with Modifier ‘C’ - ‘Load initial master key (A-key) with RSA key’. For the message, the host encodes the encrypted public key and the signature to base-94. 3. The host saves the master key, encrypted under a variant of the domain master key, for encrypting session keys (see F.5.7) 4. The ATM’s EPP verifies the signature using the HSM’s public key received earlier (see F.5.3). 5. The ATM’s EPP decrypts the master key using the EPP’s secret key which was loaded into the EPP during manufacture. 6. The ATM’s EPP stores the A-key for decrypting session keys (see F.5.7). 7. The ATM sends the KVC (aka KVV) of the master key to the host in an Encryptor Initialisation Data message (Message Class 2, Message Sub- class 3) with Information Identifier ‘3’ - ‘New KVV for key just loaded’. 8. The host compares the KVC with the KVC returned by SCM function C720. If they do not match, the host displays a console message64. 64 The master key has been loaded incorrectly on the ATM. Session key loads will be unsuccessful. IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 35 F.5.6 Manual Load As an alternative to remote initialisation, items F.5.1 - F.5.5 can be replaced by a manual load of the double-length ATM Master Key in two double-length components: NCR NDC+ ATM Host eKMVAA(A) AMB console key generation A-key 2 clear components A-key Figure 5 Generation of double-length master key for manual loading 1. The host uses a custom key generation command on the SCM console to generate a random double-length ATM master key. 2. The host stores the ATM master key, encrypted under a variant of the domain master key, for encrypting session keys (see F.5.7). 3. The host prints two clear double-length components of the ATM master key in sealed key mailers. 4. The clear components of the ATM master key are loaded into the ATM as the A-key. F.5.7 Generation of double-length session keys NCR NDC+ ATM Host eKMVAA(A) APCA2000 ATMKEYGEN 3B30 21 21 eKMV24(KMACs) eKMV48(KMACr) eKMV42(KPEr) 21 21 eA(KPE) Extended Encryption Key Load ‘2’ message eA(KMAC) APCA2000 KVC Request 7510 KVC(KPE) APCA2000 KVC Request 7510 KVC(KPE) COMPARE KVC(KMAC) KVC(KMAC) COMPARE Decrypt Decrypt Extended Encryption Key Load ‘5’ message Encryptor Initialisation Data ‘3’ message Encryptor Initialisation Data ‘3’ message Comms Key A-key MAC Key A-key PIN key MAC key Figure 6 Generation of double-length session keys IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 36 F.5.8 PIN and MAC keys 1. The host uses SCM function 3B30 to generate random double-length PIN encryption and MAC keys. This function is called with the key length set to 2 (double) and the cipher mode set to 0 (ECB). It encrypts the session keys with the master key generated earlier (see F.5.4). 2. The host stores the PIN encryption key, encrypted under a variant of the domain master key, for decrypting PIN blocks (see F.5.11). 3. The host stores the MAC key, encrypted under variants of the domain master key, for generating and verifying MACs (see F.5.12 and F.5.13). 4. The host uses SCM function 7510 to calculate the KVCs of the PIN encryption key and the MAC key. F.5.9 PIN key 1. The host sends the encrypted PIN encryption key to the ATM in an Extended Encryption Key Load message (Message Class 3, Message Sub-class 4) with Modifier ‘2’ - ‘Decipher new communications key with current master key’. 2. The ATM’s EPP decrypts the communications key and stores it for encrypting PIN blocks see (F.5.11). 3. The ATM sends the KVC of the communications key to the host in an Encryptor Initialisation Data message (Message Class 2, Message Sub- class 3) with Information Identifier ‘3’ - ‘New KVV for key just loaded’. 4. The host compares the KVC of the communications key with the KVC returned by SCM function 7510. If they do not match, the host displays a console message65. F.5.10 MAC key 1. The host sends the encrypted MAC key to the ATM in
```

