# File: chunk_000566.txt (part 1 of 1)
```
encrypting Key (KEK). The KTK or KEK will have been previously loaded into the SCM of sponsor and acquirer. These are off-line procedures performed by the sponsor and acquirer(s) before the Terminal is installed. F.6.4 Remote Initialisation of a Terminal by the Sponsor Sponsor host Terminal KIA=OWF(KCA,AIIC) SPKCA A3 ← 9830 192 eKI (KCA) eKI (KMACH) eKI(KCA) eKI(KMACH) Load Master Keys KIAAIIC1 KMACH APCA2000 LOADKCA B590 APCA2000 RANDGEN B570 eKMVAC(PKmanPPID) PPID eKMVAC(PKtcuPPID) → 9820 191 sSKman(PKtcu) sSKman(PKtcu) Load Public Key of TCU APCA2000 TCUPUBLICREC C640 SPSIGNON A1 sSKman(PKtcu) SPPUBLIC A2 ← 9830 191 PKsp PKsp RN Load Public Key of Sponsor KI eKMVA0(SKspPPID) eKMV82(KIPPID) → 9820 192 sSKtcu(cPKsp(KI,RN)) sSKtcu(cPKsp(KI,RN)) Load PIN Pad Initialisation Key APCA2000 INITIALKEYREC B580 SKtcu RN RNPPID PPID PPID PPID PPID AIIC AIIC KIAAIICn ... PPID PKspPPID eKMV44(KCAPPID) eKMV24(KMACHPPID) AIIC PPID DTS, user data DTS, user data 42 42 41 42 21 21 21 Figure 13 Remote Initialisation of a Terminal by the Sponsor IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 41 1. The Terminal sends the public key of the TCU, signed by the secret key of the manufacturer. The sponsor unsigns the TCU public key with the public key of the manufacturer. 2. The sponsor sends the public key of the sponsor, along with a random number (RN), a date time stamp (DTS), and user data. 3. The Terminal generates a random Terminal initialisation key (KI), and enciphers it with the public key of the sponsor, along with the random number RN, the PPID, the DTS, and the user data. The cipher text is signed with the secret key of the TCU and sent to the sponsor. 4. The sponsor unsigns and deciphers the message, checks the RN, PPID, DTS, and user data, and saves the KI. 5. The sponsor sends the cross acquirer key (KCA) and MAC housekeeping key (KMACH) to the Terminal, encrypted under the KI. 6. The Terminal decrypts the KCA and KMACH with KI, which is then erased. The Terminal uses KCA to derive the acquirer initialisation key (KIA) for each acquirer in its acquirer table. The KCA is then erased. Remote initialisation is performed when a Terminal is first installed in the field. It is initiated by a password-protected command entered on the Terminal. It will be necessary to repeat the remote initialisation if the Terminal cannot log on to an acquirer using either KEK1 or KEK2, implying that the values of KEK2 have become out of step between Terminal and acquirer. This is expected to be happen infrequently - no more than once per year. F.6.5 Remote Initialisation of a Terminal by an Acquirer Terminal Acquirer host ← 9830 193 eKMV82(KEK2PPID) eKMV82(KEK1PPID) eKMV88(PPASNPPID) APCA2000 TERMKEYINIT- REMOTE 6.4 3633 eKIA(KEK1) eKIA(KEK2) eKIA(PPASN) eKMV24(KMACIPPID) KMACI=OWF(KIA,AIIC) KEK2AIIC PPASNAIIC APCA2000 MACGEN 5500 MAC ACQINITKEK 13 AIIC eKIA(KEK1) eKIA(KEK2) eKIA(PPASN) MAC KEK1AIIC Acquirer Initialisation → 9820 193 PPID PPID Acquirer Signon ACQSIGNON A4 {eKIA(PPID)} {e*KIA(PPID)} APCA2000 VERIFYPPID E540 eKMV84(KIAPPID) AIIC KMACI=OWF(KIA,AIIC) PPID KIAAIIC AIIC 21 31 31 31 21 21 21 Figure 14 Remote Initialisation of a Terminal by an Acquirer The Terminal performs this procedure for each acquirer in its acquirer table (the sponsor being the first acquirer). 1. The Terminal encrypts the PPID with the acquirer’s KIA and sends the high- order 32 bits to the acquirer. 2. The acquirer verifies that the encrypted PPID is correct, thereby confirming that the Terminal is using a genuine KIA. IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 42 3. The sponsor generates random initial values for KEK1, KEK2, and the PIN pad acquirer security number (PPASN). These are encrypted under KIA and sent to the Terminal. The sponsor derives an initial MAC key (KMACI) from the KIA and the AIIC and uses it to generate a MAC for the message containing the encrypted keys. 4. The Terminal also derives KMACI and uses it to verify the MAC on the message. 5. The Terminal decrypts KEK1, KEK2, and PPASN and stores them in its key storage memory for the acquirer. The KIA for this acquirer is then erased. Note that functions E540 and 3633 can both be supplied with the encrypted KIA eKMV84(KIA) in format 23 (ECB-encrypted) as well as format 21 (CBC- encrypted). A format 23 KIA can be constructed from the e*KMV8(*KIA) produced for 1DES POS Terminals. This would allow support of a hybrid POS Terminal which performed remote initialisation with 512-bit RSA keys but performed 3DES session key management. It is may be AusPayNet’s intention, however, to discontinue support for a format 23 KIA when 3DES migration is complete. F.6.6 Logon by a Terminal to an Acquirer Acquirer host Terminal → 0800 ← 0810 eKMV82(KEK1) eKMV88(PPASN) APCA2000 HOSTPROOF – 6.4 E510 {OWF(KEK1,PPASN)} APCA2000 TERMPROOF – 6.4 E500 {eKEK1(PPASN)} PPASNVERIFY A8 (KEK1 or KEK2) {OWF(KEK1,PPASN)} GETPPASN A7 (KEK1 or KEK2) {eKEK1(PPASN)} Logon - proof of terminal endpoint Logon - proof of terminal endpoint Logon - proof of host endpoint PPASNAIIC KEK1AIIC 21 Figure 15 Logon by a Terminal to an Acquirer 1. The Terminal sends the acquirer a cryptographic function of KEK1 and PPASN which the acquirer verifies to prove that the Terminal is genuine. 2. The acquirer sends the Terminal a
```

