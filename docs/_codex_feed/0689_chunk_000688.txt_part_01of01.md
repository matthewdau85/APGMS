# File: chunk_000688.txt (part 1 of 1)
```
node to verify the MAC, decipher the data and translate or verify the PIN. (e) One set of send session keys is used at a time and all Transactions sent from the sending node will generate the MAC and encipher the PIN, if present, using the MAC Generator Key and PIN Protect Key, respectively, from the same send session key set. The send session key set used is indicated by bit 53 (contains "1" or "2") in each message. (f) Session Keys must be statistically unique and replaced, at a minimum, once every hour or on every 256 Transactions, whichever occurs first. (g) The Data Encipherment Key is unused. The Data Encipherment Key may optionally be included in the Key Change Message (see Network Management Key Change Advice message format (clause A.12.17) and clause A.13.6).59 (h) When enciphered for transmission, each session key type will use a unique variant of the Key Encrypting Key in accordance with AS 2805.6.1. NODE A NODE B Send Session Keys Set 1 Receive Session Keys Set 1 • MAC Key (KMACs1) = • MAC Verification Key (KMACr1) • PIN Protect key (KPEs1) = • PIN Protect key (KPEr1) 59 Amended effective 21/11/17, version 006 r&p 002.17 IAC CODE SET VOLUME 6 – ATM SYSTEM CODE ANNEXURE A. STANDARD INTERCHANGE SPECIFICATION Australian Payments Network Limited [ABN 12 055 136 519] 46 • Data Encipherment Key (KDs1) = • Data Decipherment Key (KDr1) Send Session Keys Set 2 Receive Session Keys Set 2 • MAC Key (KMACs2) = • MAC Verification Key (KMACr2) • PIN Protect key (KPEs2) = • PIN Protect key (KPEr2) • Data Encipherment Key (KDs2) = • Data Decipherment Key (KDr2) Receive Session Keys Set 1 Send Session Keys Set 1 • MAC Verification Key (KMACr1) = • MAC Key (KMACs1) • PIN Protect key (KPEr1) = • PIN Protect key (KPEs1) • Data Decipherment Key (KDr1) = • Data Encipherment Key (KDs1) Receive Session Keys Set 2 Send Session Keys Set 2 • MAC Verification Key (KMACr2) = • MAC Key (KMACs2) • PIN Protect key (KPEr2) = • PIN Protect key (KPEs2) • Data Decipherment Key (KDr2) = • Data Encipherment Key (KDs2) Table A.8.3 - Session Keys Establishing a Link (a) A link must be established using the 0800/0810 Network Management Messages with a NMIC of “Sign On” (001). Each side must be successfully Signed on before a session can be established. (b) A proof of endpoints check is part of the sign on process. (c) A Random number (RNs) is generated along with its inverted form (RNr) both are enciphered under KEKs. The enciphered RNs is forwarded to the interchange partner in Data Element 48 of the logon request. The enciphered RNr is stored awaiting the logon response. (d) The interchange partner will, on receipt of the sign on request, generate the inverted form of the enciphered RNs received (RNr) and return it, enciphered by KEKr, in the sign on response. The enciphered RNr must be forwarded in Data Element 48. (e) On receiving the sign on response, the enciphered RNr in the message is compared with the stored version of enciphered RNr. If the two values match, proof of endpoints is established. (f) Following these messages the key change messages establish the current session keys. Then, and only then, can other Transactions be processed. IAC CODE SET VOLUME 6 – ATM SYSTEM CODE ANNEXURE A. STANDARD INTERCHANGE SPECIFICATION Australian Payments Network Limited [ABN 12 055 136 519] 47 (h) Following is an example of the message flow to establish a link showing the key set used. The terms "send" and "receive" are from Node A's viewpoint. NODE A NODE B 0800 (Sign On)   0810 (Sign On Reply)  0800 (Sign On) 0810 (Sign On Reply)  0820 (Key Change, Send Set 1)   0830 (Key Change Reply)  0820 (Key Change, Receive Set 1) 0830 (Key Change Reply)   0200 (Receive set 1 keys) 0210 (Send set 1 keys)  etc. etc. Table A.8.4 - Establishing a Link message flow Changing Session Keys The method of session key changes is detailed below: (a) While one set of send session keys is being used, the other send session key set is randomly generated by the sending node and their KVCs generated, the keys are then enciphered under the Interchange Send KEK and transmitted to the receiving node in a 0820 “Network Management Advice” message. (b) When a 0820 message is received by the receiving node, the session keys are deciphered using the Interchange Receive KEK. These deciphered keys are set up as the set of receive keys specified by the set number contained in bit 53 of the 0820 message. The Key Verification Codes (KVCs) are calculated by the receiving node and transmitted to the sending node in bit 48 of the 0830 message. (c) When the 0830 “Network Management Advice” response message is received at the node initiating the key change, the KVCs contained in the 0830 message are validated. If the KVCs are correct, the new send session key set can be used immediately. If the KVCs are invalid, new send session key set must be generated and the whole process is repeated. Sign Off Either node may terminate the transmission of financial messages by sending a “Sign Off” advice. A “Sign Off” is accomplished by the transmission of a “Network Management Advice Message”
```

