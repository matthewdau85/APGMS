# File: chunk_000562.txt (part 1 of 1)
```
no. APCA2000 LOADPUBLIC- NDC+ C6B0 SN-EPP Extended Encryption Key Load ‘F’ message Encryptor Initialisation Data ‘1’ message (SN-EPP) * SK-NCR SN-EPP (SN-EPP) * SK-NCR PK-NCR 41 Figure 2 Authentication by Host of ATM’s EPP Serial Number IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 32 1. The host requests the serial number of the ATM’s EPP using an Extended Encryption Key Load Message (Message Class 3, Message Sub-class 4) with Modifier ‘F’ - ‘Send EPP serial number and signature’. 2. The ATM returns the EPP’s serial number and its signature, which were loaded into the EPP during manufacture. They are sent in an Encryptor Initialisation Data message (Message Class 2, Message Sub-class 3) with Information Identifier ‘1’ - ‘EPP serial number and signature’. 3. There is no function in the AusPayNet SCM specifically designed to verify the signature on an EPP serial number. The signature can be verified, however, by making it look like a public key. 4. The host pads the EPP serial number and appends the fixed exponent 65537 to produce a format 41 key for sending to the SCM. 5. The host decodes the EPP’s serial number signature from base-94 for sending to the SCM. 6. The host uses SCM function C6B0 to verify the EPP’s serial number, using the manufacturer’s public key provided by the manufacturer (see F.5.1). 7. If function C6B0 indicates that the EPP’s serial number signature is invalid, the host displays a console message61. F.5.3 Exchange of RSA Public Keys between ATM and Host Host PK-HSM Extended Encryption Key Load ‘B’ message NCR NDC+ ATM Send EPP public key APCA2000 LOADPUBLIC- NDC+ C6B0 PK-EPP PK-HSM Extended Encryption Key Load ‘G’ message Key loaded or Reject Encryptor Initialisation Data ‘5’ message Encryptor Initialisation Data ‘2’ message (PK-HSM) * SK-NCR (PK-HSM) * SK-NCR (PK-EPP) * SK-NCR PK-EPP (PK-EPP) * SK-NCR PK-HSM 41 PK-NCR 41 eKMVAC(PK-EPP) 42 PK-NCR Verify Figure 3 Authentication by Host of ATM’s EPP Serial Number 61 ATM sent invalid EPP serial number. Master key load will be unsuccessful IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 33 1. The host sends the host’s public key to the ATM, along with the signature provided by the manufacturer (see F.5.1). They are sent in an Extended Encryption Key Load message (Message Class 3, Message Sub-class 4) with Modifier ‘B’ - ‘Load HSM public key and signature’. For the message, the host removes the exponent from the host’s public key, and encodes the host’s public key modulus and the signature to base-94. 2. The ATM’s EPP verifies the signature of the host’s public key, using the manufacturer’s public key which was loaded into the EPP during manufacture. 3. The ATM sends an Encryptor Initialisation Data message (Message Class 2, Message Sub-class 3) with Information Identifier ‘5’ - ‘Key Loaded’. 4. If the host does not receive this ‘Key Loaded’ message, it displays a console message62 and does not proceed with the key exchange. 5. The host requests the public key of the ATM’s EPP using an Extended Encryption Key Load Message (Message Class 3, Message Sub-class 4) with Modifier ‘G’ - ‘Send EPP public key and signature. 6. The ATM returns the EPP’s public key and its signature, which were loaded into the EPP during manufacture. They are sent in an Encryptor Initialisation Data message (Message Class 2, Message Sub-class 3) with Information Identifier ‘2’ - ‘EPP public key and signature’. 7. The host decodes the EPP’s public key modulus from base-94 and appends the fixed exponent 65537 to produce a format 41 key for sending to the SCM. 8. The host decodes the EPP’s public key signature from base-94 for sending to the SCM. 9. The host uses SCM function C6B0 to verify the EPP’s public key, using the manufacturer’s public key provided by the manufacturer (see F.5.1) 10. If function C6B0 indicates that the EPP’s public key signature is valid, it encrypts the EPP’s public key under a variant of the domain master key, and the host stores it for encrypting an ATM master key (see F.5.4). 11. If function C6B0 indicates that the EPP’s public key signature is invalid, the host displays a console message63 and does not store an encrypted EPP’s public key. 62 The key exchange failed and no keys were loaded. Master key load will be unsuccessful. 63 Host’s public key loaded on ATM but ATM’s public key not loaded on host. Master key load will be unsuccessful. IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 34 F.5.4 Generation of double-length ATM Master Key Host eKMVA0(SK-HSM) APCA2000 NODEKEKSEND- NDC+ C720 42 21 eKMVAA(A) KVC(A) [A-key] PK-EPP Extended Encryption Key Load ‘C’ message NCR NDC+ ATM COMPARE Verify signature and decrypt KVC(A-key) Encryptor Initialisation Data ‘3’ message ([A-key] PK-EPP) * SK-HSM eKMVAC(PK-EPP) 42 A-Key PK-HSM SK-EPP Figure 4 Generation of double-length ATM Master Key F.5.5 Remote Initialisation 1. The host uses SCM function C720 to generate a random double-length master key. The SCM function pads the master key to 256 bytes and encrypts it with the EPP’s public key
```

