# File: chunk_000565.txt (part 1 of 1)
```
1, Message Sub-class 1). 3. The host uses SCM function 5630 to verify the MAC. The MAC receive key is the same as the ATM’s MAC key (see F.5.7). The MAC algorithm used by SCM function 5630 is MAC algorithm 2 from AS 2805.4.1 (functionally equivalent to MAC algorithm 3 in ISO 9797-1). The MAC is calculated over the entire message. F.6 EFTPOS Terminals - 3DES69 Key management is accomplished by the exchange of messages between Terminal and host system(s), and the execution of complementary cryptographic functions by the Terminal and host application software. The following diagrams and descriptions are indicative of the messages and functions needed to support remote initialisation and session key management. Only those message fields relevant to key management are shown. For remote initialisation, three RSA key pairs are used. The modulus of each key pair is nominally 1024 bits in size, but the actual sizes are constrained to prevent reblocking for operations involving more than one key pair: 1. The manufacturer’s key (SKman, PKman) is 1024 bits, stored on the host as 16 8-byte blocks (1024 = 16 × 8 × 8). 2. The Terminal’s key (SKtcu, PKtcu) is 960 bits, so that its modulus or exponent can be signed by SKman, which is one block bigger (960 = 15 × 8 × 8). 3. The sponsor’s key (SKsp, PKsp) is 896 bits, so that data (*KI, etc) enciphered with this key can be signed by SKtcu, which is one block bigger (896 = 14 × 8 × 8). 69 Amended effective 20/8/18, version 007 r&p 001.18 IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 39 F.6.1 Key Loading of a Terminal by the Manufacturer Terminal PPID sSKman(PKtcu) SKtcu Figure 10 Key Loading of a Terminal by the Manufacturer The following items are loaded into the Terminal by manufacturer in a secure area before the Terminal is installed in the field: 1. PPID: a unique PIN pad identifier consisting of 16 decimal digits. The PPID includes a manufacturer code, year and month of manufacturer, and a unique PIN pad serial number. 2. SKtcu: the secret key of the TCU. The modulus of this key contains 960 significant bits. 3. sSKman(PKtcu): the public key of the TCU, signed with the secret key of the manufacturer. The TCU key pair is statistically unique for each Terminal manufactured. F.6.2 Key Loading and Generation by the Sponsor → Sponsor host eKMVAC(PKmanPPID) APCA2000 LOADPUBLIC C6A0 PKspPPID APCA2000 GETPUBLICPAIR C630 eKMVA0(SKspPPID) eKMV44(KCAPPID) APCA2000 SPONSORKEYGEN B510 AIIC APCA2000 KACALC B520 KIA=OWF(KCA,AIIC) eKMV84(KIAPPID) eKMV24(KMACHPPID) 42 41 42 21 21 21 PKman Load Public Key of Manufacturer PVC(PKman) PPID Figure 11 Key Loading and Generation by the Sponsor 1. The PPID of the Terminal and the manufacturer’s public key are communicated to the sponsor in a secure manner. The sponsor loads the manufacturer’s public key on the host system. The manufacturer can use the same public key for all Terminals for this sponsor, or for batches of Terminals for this sponsor, but it must not be disclosed to any other party. The modulus of this key contains 1024 significant bits. 2. The sponsor generates a public and secret key pair. The same key pair may be used for all Terminals or for batches of Terminals. The modulus of these keys contains 896 significant bits. IAC CODE SET VOLUME 4 - DEVICE REQUIREMENTS AND CRYPTOGRAPHIC MANAGEMENT ANNEXURE F. INTRODUCTION TO DEVICE SUPPORT AND SCM FUNCTIONALITY Australian Payments Network Limited [ABN 12 055 136 519] 40 3. The sponsor generates a random cross acquirer key (KCA) and MAC housekeeping key (KMACH). 4. The sponsor uses the KCA to derive the sponsor’s acquirer initialisation key (KIA) using the sponsor’s Acquiring Institution Identification Code (AIIC). These are all off-line procedures performed by the sponsor before the Terminal is installed. F.6.3 Key Transmission to an Acquirer ← Sponsor host eKMV44(*KCAPPID) AIIC eKTK(KIA) APCA2000 KAEXPORT B530 Acquirer host APCA2000 KAIMPORT B540 KTK KTK ← eKEKrV84(KIA) APCA2000 KIASEND B550 eKMV84(KIAPPID) APCA2000 KIAREC B560 eKMV84(KEKr) eKMV82(KEKs) eKEKsV84(KIA) Send Acquirer Initialisation key PPID PPID APCA2000 KACALC B520 KIA=OWF(KCA,AIIC) 21 eKMV84(KIAPPID) 21 21 21 21 eKMV84(KIAPPID) 21 eKTK(KIA) Export Acquirer Initialisation key PPID PPID OR Figure 12 Key Transmission to an Acquirer For multi-acquirer Terminals, the sponsor conveys the acquirer initialisation key (KIA) for each Terminal to each acquirer. The KIA is encrypted for transmission using either a key transport key (KTK) or a Key encrypting Key (KEK). The KTK or KEK will have been previously loaded into the SCM of sponsor and acquirer. These are off-line procedures performed by the sponsor and acquirer(s) before the Terminal is installed. F.6.4 Remote Initialisation of a Terminal by the Sponsor Sponsor host Terminal KIA=OWF(KCA,AIIC) SPKCA A3 ← 9830 192 eKI (KCA) eKI (KMACH) eKI(KCA) eKI(KMACH) Load Master Keys KIAAIIC1 KMACH APCA2000 LOADKCA B590 APCA2000 RANDGEN B570 eKMVAC(PKmanPPID) PPID eKMVAC(PKtcuPPID) → 9820 191 sSKman(PKtcu) sSKman(PKtcu) Load Public Key of TCU APCA2000 TCUPUBLICREC C640 SPSIGNON A1 sSKman(PKtcu) SPPUBLIC A2 ← 9830 191 PKsp PKsp RN Load Public Key of Sponsor KI eKMVA0(SKspPPID) eKMV82(KIPPID) → 9820 192 sSKtcu(cPKsp(KI,RN)) sSKtcu(cPKsp(KI,RN)) Load PIN Pad Initialisation Key APCA2000 INITIALKEYREC B580 SKtcu RN RNPPID PPID PPID PPID PPID AIIC AIIC KIAAIICn ... PPID PKspPPID eKMV44(KCAPPID) eKMV24(KMACHPPID) AIIC PPID DTS, user data DTS, user data 42 42 41 42 21 21 21 Figure 13 Remote
```

